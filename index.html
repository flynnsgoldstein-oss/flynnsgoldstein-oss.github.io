<!DOCTYPE html>
<html lang="he">
<head>
<meta charset="UTF-8">
<title>זמני היום - Gra</title>
<link href="https://fonts.googleapis.com/css2?family=David+Libre&display=swap" rel="stylesheet">
<style>
  body {
    background: #000;
    color: #fff;
    font-family: 'David Libre', serif;
    text-align: center;
    direction: rtl;
    margin: 0;
    padding: 2vh 1vw;
  }

  /* Current time & date */
  #currentTimeLabel {
    font-size: 4vh;
    margin-bottom: 0.5vh;
  }
  #currentTime {
    font-size: 8vh;
    margin-bottom: 0.5vh;
  }
  #currentDate {
    font-size: 3vh;
    color: #ccc;
    margin-bottom: 3vh;
  }

  /* Zman titles */
  h1 {
    font-size: 6vh;
    margin: 2vh 0 1vh 0;
  }

  /* Gra times + countdown container */
  .time-container {
    display: flex;
    justify-content: center;
    align-items: center;
    margin-bottom: 3vh;
  }

  /* Gra time text */
  p.time {
    font-size: 12vh;   /* Maximize horizontally */
    padding: 0.5vh 2vw;
    border: 3px dotted #fff;
    border-radius: 10px;
    margin: 0 1vw 0 0;
    min-width: 20ch;
  }

  /* Countdown text (2/3 size of main time) */
  span.countdown {
    font-size: 8vh;
    margin: 0 0 0 1vw;
    color: #ccc;
    white-space: nowrap;
  }
</style>
</head>
<body>
  <div id="currentTimeLabel">השעה הנוכחית</div>
  <div id="currentTime">--:--:--</div>
  <div id="currentDate">--/--/----</div>

  <h1>סוף זמן קריאת שמע</h1>
  <div class="time-container">
    <p id="shemaTime" class="time">--:--</p>
    <span id="shemaCountdown" class="countdown">--</span>
  </div>

  <h1>סוף זמן תפילה</h1>
  <div class="time-container">
    <p id="tefillahTime" class="time">--:--</p>
    <span id="tefillahCountdown" class="countdown">--</span>
  </div>

  <script>
    let shemaTimeValue = null;
    let tefillahTimeValue = null;

    async function fetchJewishDate() {
      const today = new Date();
      const yyyy = today.getFullYear();
      const mm = String(today.getMonth()+1).padStart(2,'0');
      const dd = String(today.getDate()).padStart(2,'0');
      const url = `https://www.hebcal.com/converter?cfg=json&gy=${yyyy}&gm=${mm}&gd=${dd}&g2h=1`;
      try {
        const res = await fetch(url);
        const data = await res.json();
        return `${data.hebrew} (${data.hd}/${data.hm}/${data.hy})`;
      } catch(e) {
        console.error('Error fetching Jewish date:', e);
        return '--';
      }
    }

    function updateCurrentTime() {
      const now = new Date();
      document.getElementById('currentTime').innerText = now.toLocaleTimeString('he-IL', {hour12:false});
    }

    async function updateCurrentDate() {
      const jewishDate = await fetchJewishDate();
      const now = new Date();
      const gregDate = now.toLocaleDateString('en-US');
      document.getElementById('currentDate').innerText = `${jewishDate} | ${gregDate}`;
    }

    function updateCountdowns() {
      const now = new Date();
      function formatCountdown(targetTime) {
        if (!targetTime) return '--';
        if (now >= targetTime) return 'עבר זמנו ביטול קרנבו?';
        let diff = targetTime - now;
        const hours = String(Math.floor(diff / (1000*60*60))).padStart(2,'0');
        diff %= 1000*60*60;
        const minutes = String(Math.floor(diff / (1000*60))).padStart(2,'0');
        diff %= 1000*60;
        const seconds = String(Math.floor(diff / 1000)).padStart(2,'0');
        return `${hours}:${minutes}:${seconds}`;
      }
      document.getElementById('shemaCountdown').innerText = formatCountdown(shemaTimeValue);
      document.getElementById('tefillahCountdown').innerText = formatCountdown(tefillahTimeValue);
    }

    async function fetchZmanim() {
      const today = new Date();
      const yyyy = today.getFullYear();
      const mm = String(today.getMonth()+1).padStart(2,'0');
      const dd = String(today.getDate()).padStart(2,'0');
      const url = `https://www.hebcal.com/zmanim?cfg=json&geonameid=5178225&date=${yyyy}-${mm}-${dd}`;
      try {
        const res = await fetch(url);
        const data = await res.json();

        shemaTimeValue = data.times.sofZmanShma ? new Date(data.times.sofZmanShma) : null;
        tefillahTimeValue = data.times.sofZmanTfilla ? new Date(data.times.sofZmanTfilla) : null;

        document.getElementById('shemaTime').innerText = shemaTimeValue
          ? shemaTimeValue.toLocaleTimeString('he-IL', {hour:'2-digit', minute:'2-digit', hour12:false})
          : 'לא זמין';
        document.getElementById('tefillahTime').innerText = tefillahTimeValue
          ? tefillahTimeValue.toLocaleTimeString('he-IL', {hour:'2-digit', minute:'2-digit', hour12:false})
          : 'לא זמין';

      } catch(err) {
        console.error(err);
        document.getElementById('shemaTime').innerText = 'שגיאה';
        document.getElementById('tefillahTime').innerText = 'שגיאה';
      }
    }

    fetchZmanim();
    updateCurrentDate();

    setInterval(() => {
      updateCurrentTime();
      updateCountdowns();
    }, 1000);

    setInterval(() => {
      fetchZmanim();
      updateCurrentDate();
    }, 60*60*1000);
  </script>
</body>
</html>
